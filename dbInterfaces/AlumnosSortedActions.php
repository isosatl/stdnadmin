<?phptry {                                              header("Content-Type: text/html;charset=utf-8");    require('../DB.php');     //    $dbh = null; don't forget to close the connection!    //Extraer records filtrados  (listAction)    if ($_GET["action"] == "list1") {        //extraer registros de la base de datos para contarlos        if (!$result = $dbh->prepare("SELECT COUNT(*) AS Registros FROM alumnos;")) {            throw new Exception('Query failed: ' . mysql_error($dbh));        }		$result->execute();        $row = $result->fetch(PDO::FETCH_ASSOC);        $registros = $row['Registros'];        //extraer registros desde la base de datos para mostrarlos        if (!$result = ("SELECT id_alumnos, id_a_grados, id_a_secciones, id_a_carreras, nombres_alumnos, apellidos_alumnos                    FROM alumnos                    ORDER BY " . $_GET["jtSorting"] . " LIMIT " . $_GET["jtStartIndex"] . "," . $_GET["jtPageSize"] . ";")) {            throw new Exception('Query failed: ' . mysql_error($dbh));        }        //Add all records to an array        $rows = array();        foreach ($dbh->query($result) as $row) {            $rows[] = $row;        }        //Return result to jTable        $jTableResult = array();        $jTableResult['Result'] = "OK";        $jTableResult['TotalRecordCount'] = $registros;        $jTableResult['Records'] = $rows;        print json_encode($jTableResult);    }    //extraer registros de la base de datos para contarlos    if ($_GET["action"] == "list") {        //Get records from database        if (!$result = $dbh->prepare("SELECT COUNT(*) AS Registros FROM alumnos;")) {            throw new Exception('Query failed: ' . mysql_error($dbh));        }        $result->execute();        $row = $result->fetch(PDO::FETCH_ASSOC);        $registros = $row['Registros'];        //extraer registros desde la base de datos para mostrarlos        $result = ("SELECT * FROM alumnos ORDER BY " . $_GET["jtSorting"] . " LIMIT " . $_GET["jtStartIndex"] . "," . $_GET["jtPageSize"] . ";");        //Add all records to an array        $rows = array();        foreach ($dbh->query($result) as $row) {            $rows[] = $row;        }        //Return result to jTable        $jTableResult = array();        $jTableResult['Result'] = "OK";        $jTableResult['TotalRecordCount'] = $registros;        $jTableResult['Records'] = $rows;        print json_encode($jTableResult);    }    //Creating a new record (createAction)    else if ($_GET["action"] == "create") {        if (!$result = $dbh->prepare("INSERT INTO alumnos(cod_mineduc, nombres_alumnos, apellidos_alumnos,			fecha_nacimiento, genero, dpi, tel_casa, cell, direccion_alumnos, 			estatus_mineduc, categoria, fecha_enrrolled, estatus_grd_anterior, es_nuevo_ingreso,			id_a_grados, id_a_secciones, id_a_carreras, id_a_establecimientos)			VALUES('" . $_POST["cod_mineduc"] . "', '" . $_POST["nombres_alumnos"] . "', '"            . $_POST["apellidos_alumnos"] . "', '" . $_POST["fecha_nacimiento"] . "', '"            . $_POST["genero"] . "', '" . $_POST["dpi"] . "', '" . $_POST["tel_casa"] . "','"            . $_POST["cell"] . "','" . $_POST["direccion_alumnos"] . "','" . $_POST["estatus_mineduc"] . "', '"            . $_POST["categoria"] . "', '" . $_POST["fecha_enrrolled"] . "','" . $_POST["estatus_grd_anterior"] . "', '"             . $_POST["es_nuevo_ingreso"] . "','" . $_POST["id_a_grados"] . "','"            . $_POST["id_a_secciones"] . "','" . $_POST["id_a_carreras"] . "','" . $_POST["id_a_establecimientos"] . "');")) {            throw new Exception('Query failed: ' . mysql_error($dbh));        }        $result->execute();        //Get last inserted record (to return to jTable)        $result = $dbh->prepare("SELECT * FROM alumnos WHERE id_alumnos = LAST_INSERT_ID();");        $result->execute();        $row = $result->fetch(PDO::FETCH_ASSOC);        //Return result to jTable        $jTableResult = array();        $jTableResult['Result'] = "OK";        $jTableResult['Record'] = $row;        print json_encode($jTableResult);    }    //Updating a record (updateAction)    else if ($_GET["action"] == "update") {        if (!$result = $dbh->prepare("UPDATE alumnos SET cod_mineduc = '" . $_POST["cod_mineduc"]            . "', nombres_alumnos = '" . $_POST["nombres_alumnos"] . "', apellidos_alumnos = '" . $_POST["apellidos_alumnos"]            . "', fecha_nacimiento = '" . $_POST["fecha_nacimiento"] . "', genero = '" . $_POST["genero"]            . "', dpi = '" . $_POST["dpi"] . "', tel_casa = '" . $_POST["tel_casa"]            . "', cell = '" . $_POST["cell"] . "', direccion_alumnos = '" . $_POST["direccion_alumnos"]            . "', estatus_mineduc = '" . $_POST["estatus_mineduc"] . "', categoria = '" . $_POST["categoria"]            . "', estatus_grd_anterior = '" . $_POST["estatus_grd_anterior"]            . "', es_nuevo_ingreso = '" . $_POST["es_nuevo_ingreso"]            . "', id_a_grados = " . $_POST["id_a_grados"] . ", id_a_secciones = " . $_POST["id_a_secciones"]            . ", id_a_carreras = " . $_POST["id_a_carreras"] . ", id_a_establecimientos = " . $_POST["id_a_establecimientos"]            . " WHERE id_alumnos = " . $_POST["id_alumnos"] . ";")) {            throw new Exception('Query failed: ' . mysql_error($dbh));        }        $result->execute();        //Get last updated record (to return to jTable)        $result = $dbh->prepare("SELECT * FROM alumnos ;");        $result->execute();        $row = $result->fetch(PDO::FETCH_ASSOC);        //Return result to jTable        $jTableResult = array();        $jTableResult['Result'] = "OK";        print json_encode($jTableResult);    }    //Deleting a record (deleteAction)    else if ($_GET["action"] == "delete") {        if (!$result = $dbh->prepare("DELETE FROM alumnos WHERE id_alumnos = " . $_POST["id_alumnos"] . " ; ")) {            throw new Exception('Query failed: ' . mysql_error($dbh));        }        $result->execute();        //Return result to jTable        $jTableResult = array();        $jTableResult['Result'] = "OK";        print json_encode($jTableResult);    }    /* close the database connection */        $dbh = null;    if ($dbh) {        var_dump($dbh, " connection still active");    }}//catch(Exception $ex){catch (Exception $ex) {    $ex->getMessage();    print $ex;    //Return error message    $jTableResult = array();    $jTableResult['Result'] = "ERROR";    $jTableResult['Message'] = $ex->getMessage();    print json_encode($jTableResult);}?>