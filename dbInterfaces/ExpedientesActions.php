<?phptry{header("Content-Type: text/html;charset=utf-8");require('../DB.php');     //    $dbh = null; don't forget to close the connection!	//Getting records (listAction)	if($_GET["action"] == "list"){        if(!$result = ("SELECT * FROM expedientes WHERE id_ex_alumnos = " . $_GET["id_alumnos"]. " ;")){            throw new Exception('Query failed: '. mysql_error($dbh));        }				//Add all records to an array		$rows = array();            foreach ($dbh->query($result) as $row) {            $rows[] = $row;        }                      		//Return result to jTable		$jTableResult = array();		$jTableResult['Result'] = "OK";		$jTableResult['Records'] = $rows;		print json_encode($jTableResult);	}    //Creating a new record (createAction)	    else if ($_GET["action"] == "create") {        if (!$result = $dbh->prepare("INSERT INTO expedientes(fe_edad, primero_primaria, segundo_primaria, tercero_primaria,		cuarto_primaria, quinto_primaria, sexto_primaria, diploma_primaria, primero_basico, segundo_basico, tercero_basico,		diploma_basico, mecanografia, carta_conducta, cuarto_carrera, quinto_carrera, complecion_estatus, notas,		id_ex_alumnos, id_ex_grados, id_ex_secciones, id_ex_carreras)        VALUES('" . $_POST["fe_edad"] . "','" . $_POST["primero_primaria"] . "','" . $_POST["segundo_primaria"] . "','" . $_POST["tercero_primaria"] . "','" . $_POST["cuarto_primaria"] . "',        '" . $_POST["quinto_primaria"] . "','" . $_POST["sexto_primaria"] . "','" . $_POST["diploma_primaria"] . "','" . $_POST["primero_basico"] . "','" . $_POST["segundo_basico"] . "',        '" . $_POST["tercero_basico"] . "','" . $_POST["diploma_basico"] . "','" . $_POST["mecanografia"] . "','" . $_POST["carta_conducta"] . "','" . $_POST["cuarto_carrera"] . "',        '" . $_POST["quinto_carrera"] . "','" . $_POST["complecion_estatus"] . "','" . $_POST["notas"] . "'," . $_POST["id_ex_alumnos"] . "," . $_POST["id_ex_grados"] . ",        " . $_POST["id_ex_secciones"] . "," . $_POST["id_ex_carreras"] . ");")) {            throw new Exception('Query failed: ' . mysql_error($dbh));        }        $result->execute();        //Get last inserted record (to return to jTable)        $result = $dbh->prepare("SELECT * FROM expedientes WHERE id_expedientes = LAST_INSERT_ID();");        $result->execute();		$row = $result->fetch(PDO::FETCH_ASSOC);        //Return result to jTable        $jTableResult = array();        $jTableResult['Result'] = "OK";        $jTableResult['Record'] = $row;        print json_encode($jTableResult);    }    //Updating a record (updateAction)	else if($_GET["action"] == "update"){		//Update record in database		if(!$result = $dbh->prepare("UPDATE expedientes SET  fe_edad = '" . $_POST["fe_edad"] . "', primero_primaria = '" . $_POST["primero_primaria"] .		 "', segundo_primaria = '" . $_POST["segundo_primaria"] . "', tercero_primaria = '" . $_POST["tercero_primaria"] . 		 "', cuarto_primaria = '" . $_POST["cuarto_primaria"] . "', quinto_primaria = '" . $_POST["quinto_primaria"] . "', sexto_primaria = '" . $_POST["sexto_primaria"] .		 "', diploma_primaria = '" . $_POST["diploma_primaria"] . "', primero_basico = '" . $_POST["primero_basico"] . "', segundo_basico = '" . $_POST["segundo_basico"] .		 "', tercero_basico = '" . $_POST["tercero_basico"] . "', diploma_basico = '" . $_POST["diploma_basico"] . "' , mecanografia = '" . $_POST["mecanografia"] .		 "', carta_conducta = '" . $_POST["carta_conducta"] . "', cuarto_carrera = '" . $_POST["cuarto_carrera"] . "', quinto_carrera = '" . $_POST["quinto_carrera"] .		 "', complecion_estatus = '" . $_POST["complecion_estatus"] ."', notas = '" . $_POST["notas"] . "', id_ex_alumnos = " . $_POST["id_ex_alumnos"] .		 ", id_ex_grados = " . $_POST["id_ex_grados"] . ", id_ex_secciones = " . $_POST["id_ex_secciones"] . ", id_ex_carreras = " . $_POST["id_ex_carreras"] . 		 " WHERE id_expedientes = " . $_POST["id_expedientes"]. ";")){			throw new Exception('Query failed: '. mysql_error($dbh));				     		     }         $result->execute();		//Return result to jTable		$jTableResult = array();		$jTableResult['Result'] = "OK";		print json_encode($jTableResult);	}	//Deleting a record (deleteAction)	else if($_GET["action"] == "delete"){		if(!$result = $dbh->prepare("DELETE FROM expedientes WHERE id_expedientes = " . $_POST["id_expedientes"] ." ; ")){			throw new Exception('Query failed: '. mysql_error($dbh));								}        $result->execute();		//Return result to jTable		$jTableResult = array();		$jTableResult['Result'] = "OK";		print json_encode($jTableResult);	}    /* close the database connection */    $dbh = null;    if($dbh){        var_dump($dbh, " connection still active");    }}    catch(Exception $ex){    $ex->getMessage();    print $ex;    //Return error message	$jTableResult = array();	$jTableResult['Result'] = "ERROR";	$jTableResult['Message'] = $ex->getMessage();	print json_encode($jTableResult);}	?>