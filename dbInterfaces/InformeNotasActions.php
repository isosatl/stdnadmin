<?phptry{    header("Content-Type: text/html;charset=utf-8");    require('../DB.php');     //    $dbh = null; don't forget to close the connection!    /** query para poblar listBox de secciones ***/    if ($_GET["action"] == "poblarUnidadesBox") {        $rows = array();        if (!$sql = "SELECT id_unidades, nombre_de_unidad FROM unidades"){            throw new Exception('Query failed: '. mysql_error($dbh));                    }        foreach ($dbh->query($sql) as $row) {            $rows[] = $row;        }        header('Content-type: text/json');        print json_encode($rows);    }        else if ($_GET["action"] == "poblarAsignaBox"){                $rows = array();        if ($_GET["id_secciones"]){            if (!$sql = "SELECT c.id_cursos, c.nombre_d_curso FROM cursos AS c INNER JOIN calificaciones ca            ON c.id_cursos = ca.id_ca_cursos WHERE ca.id_ca_secciones = " . $_GET["id_secciones"] . "            AND ca.id_ca_unidades = " . $_GET["id_unidades"] . ";"){                throw new Exception('Query failed: '. mysql_error($dbh));            }            foreach ($dbh->query($sql) as $row) {                $rows[] = $row;            }        header('Content-type: text/json');        print json_encode($rows);                    }                else if ($_GET["alumno"]){            $alumno = $_GET["alumno"];            if (!$sql = "SELECT a.id_alumnos, c.id_cursos, c.nombre_d_curso, ca.id_ca_alumnos FROM alumnos a                        INNER JOIN calificaciones ca ON ca.id_ca_alumnos = a.id_alumnos                        INNER JOIN cursos c ON c.id_cursos = ca.id_ca_cursos                        WHERE a.nombres_alumnos LIKE '" . $alumno . "%';"){                throw new Exception('Query failed: '. mysql_error($dbh));            }            foreach ($dbh->query($sql) as $row) {                $rows[] = $row;            }        header('Content-type: text/json');        print json_encode($rows);                                }    }    else if ($_GET["action"] == "mostrarNotas"){                $rows = array();        $alumno = $_GET["alumno"];        if ($_GET["alumno"]){            if (!$sql = "SELECT CONCAT(a.nombres_alumnos, ' ', a.apellidos_alumnos) AS Alumno, ca.id_ca_alumnos,                ca.calificacion, ca.id_ca_cursos, ca.id_ca_secciones, ca.id_ca_unidades                 FROM alumnos AS a INNER JOIN calificaciones ca ON ca.id_ca_alumnos = a.id_alumnos                 WHERE a.nombres_alumnos LIKE '" . $alumno . "%'                AND ca.id_ca_cursos = " .$_GET["id_cursos"] . "                AND ca.id_ca_unidades = " .$_GET["id_unidades"] . "            ;"){                                throw new Exception('Query failed: '. mysql_error($dbh));                        }            foreach ($dbh->query($sql) as $row) {                $rows[] = $row;            }        header('Content-type: text/json');        print json_encode($rows);                                        }                else if ($_GET["id_secciones"]){            if (!$sql = "SELECT CONCAT(a.nombres_alumnos, ' ', a.apellidos_alumnos) AS Alumno, ca.id_ca_alumnos,                ca.calificacion, ca.id_ca_cursos, ca.id_ca_secciones, ca.id_ca_unidades                 FROM alumnos AS a INNER JOIN calificaciones ca                ON ca.id_ca_alumnos = a.id_alumnos                 WHERE ca.id_ca_cursos = " .$_GET["id_cursos"] . "                AND ca.id_ca_unidades = " .$_GET["id_unidades"] . "                AND ca.id_ca_secciones = " .$_GET["id_secciones"] . ";"){                                throw new Exception('Query failed: '. mysql_error($dbh));                        }            foreach ($dbh->query($sql) as $row) {                $rows[] = $row;            }        header('Content-type: text/json');        print json_encode($rows);                    }    }        else if ($_GET["action"] == "notasdeAlumno"){        $rows = array();        if (!$sql = "SELECT CONCAT(a.nombres_alumnos, ' ', a.apellidos_alumnos) AS Alumno, ca.id_ca_alumnos,            ca.calificacion, ca.id_ca_cursos, ca.id_ca_secciones, ca.id_ca_unidades             FROM alumnos AS a INNER JOIN calificaciones ca            ON ca.id_ca_alumnos = a.id_alumnos             WHERE ca.id_ca_cursos = " .$_GET["id_cursos"] . "            AND ca.id_ca_unidades = " .$_GET["id_unidades"] . "            AND a.nombres_alumnos = " .$_GET["alumno"] . ";"){                                    throw new Exception('Query failed: '. mysql_error($dbh));                                }        foreach ($dbh->query($sql) as $row) {            $rows[] = $row;        }        header('Content-type: text/json');        print json_encode($rows);    }        /* close the database connection */    $dbh = null;    if($dbh){        var_dump($dbh, " connection still active");    }}    catch(Exception $ex){    $ex->getMessage();    print $ex;    }?>