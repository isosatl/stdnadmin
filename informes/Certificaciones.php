<?php    //Script para determinar si se ha iniciado sessión y si es administrador.    if (session_id() == ''){        session_start();                    if (isset($_SESSION['privilegios'])){            if ($_SESSION['privilegios'] == 'admin'){                //mostrar contenido que corresponda a administrador                //print_r($_SESSION['privilegios']);                            }        }    }        if (!isset($_SESSION['usuario']) || (!isset($_SESSION['clave']))) {        $_SESSION['violation'] = 1;        header('Location: ./login.php');        exit();    } if (isset($_SESSION['timeout'])) {        $sessionTTL = time() - $_SESSION['timeout'];        if ($sessionTTL > $_SESSION['tiempoLimite']) {            $_SESSION['logedout'] = 1;            header('Location: ./login.php');            exit();        }    }    $_SESSION['timeout'] = time();    print_r($_SESSION);    include ROOT_DIR . '/includes/header.php';    include ROOT_DIR . '/includes/navinformes.php';?>    <body id="cert">    <!--div contenedor general-->    <div id="cert-contenedor">        <div><p class="p1">Certificación de notas por sección, ó por alumno.</p> </div>    <div><p class="p2">Clic en el botón para realizar consulta.</p> </div>        <div class="list-boxes">    <div class="consulta-uno">        <form action="" class="frm-dropdown-uno">            <table>                <tr>                    <th id="th-selecc-secc" class="th-drops">                                        <select class="tooltip" title="Seleccione una sección y haga clic en el botón" id="select-secc">                        <option id="drops-opt-secc" value="Default" selected="selected"> Seleccione una sección</option>                    </select>                    </th>                </tr>                <tr>                    <th id="th-alumnos" class="th-drops">                        <input class="tooltip" title="Escriba el nombre del alumno y de clic sobre el mismo cuando aparezca"                                 type="text" id="service" name="service" onclick="limpiarElementos(this.form)"                                 onFocus="limpiarElementos(this.form)" value="Nombre del alumno...?" ></input>                    </th>                </tr>            </table>        </form>    </div>    <div class="consulta-dos">        <form action="" class="frm-dropdown-dos">            <table>                <tr>                    <th id="th-boton" class="th-drops">                                            <input class="tooltip" title="Al dar clic se muestran los alumnos con sus respectivas calificaciones"                         id="boton" type="button" value="Buscar" ></input>                    </th>                </tr>            </table>        </form>        <div id="suggestions" style="display: block"></div>    </div>        <!-- listBoxe's-->    </div>        <!-- div para mostrar progreso de la carga o errores -->    <div style= "border:1px;" id="info"></div>    <div style = "border: 1px;" id="error"></div>        <div id="titulo-contenido"> Título</div>    <div class="cert-contenido">        <table class="contenido-table">            <thead class="contenido-table-head">            </thead>            <tbody class="tb-contenido">            </tbody>        </table>               <!-- div del contenido-->    </div>            <!-- div para la tabla de asignaturas-->    <div class="div-tabla-asignaturas">        <table class="asigna-table">            <thead class="table-head-asigna">                <tr><th class="tabla-asigna-table-title" colspan="2">Asignaturas de la sección</th></tr>                <tr><th>Id</th><th>Asignatura</th></tr>            </thead>            <tbody class="tb-asigna">            </tbody>        </table>            </div>                    <!-- div contenedor-->    </div>        <!-- Pie de esta pÃ¡gina -->    <div id="footer_container"></div>      <script type="text/javascript">    $(document).ready(function(e){        /* poblar secciones */                fillSecciones();                      /* ocultar el div de auto complete*/        $('#suggestions').hide();            });    $('select.tooltip').tooltip({        rounded: true    });        $('input.tooltip').tooltip({        rounded: true    });    /* al precionar una tecla sobre el input de alumno muestra los resultados de autocomplete*/    $('#service').one('keypress', function(e){        $('#suggestions').animate({height:100, width:150, opacity: .75}, 1000, 'linear', function(){});                });        /*Cuando la búsqueda es por alumno, copia el nombre al título */    $('#service').bind('blur', function(){        var nombres_alumnos = "";        nombres_alumnos = $(this).val();        $("#titulo-contenido").text(nombres_alumnos);                    });    /* acción de auto completado*/    //Al escribr dentro del input con id="service"                    $('#service').bind('keypress', function(){        //var aszTemp = (this.tagName).toLowerCase()                /*** opacar select secciones y habilitar input de alumno***/        //opacarOpcion(aszTemp);                //Obtenemos el value del input        var service = $(this).val();        var dataString = 'service='+service;              //Le pasamos el valor del input al ajax        $.ajax({            type: "POST",            url: "dbInterfaces/InfAlumnosActions.php?action=autoCompletado",            data: dataString,            cache: false,            success: function(data) {                                    //Escribimos las sugerencias que nos manda la consulta                $('#suggestions').slideDown(1000).html(data);                //Al hacer click en algua de las sugerencias                $('.suggest-element').live('click', function(){                    //Obtenemos la id unica de la sugerencia pulsada                    var id = $(this).attr('id');                    //Editamos el valor del input con data de la sugerencia pulsada                    $('#service').val($('#'+id).attr('data'));                    $("#titulo-contenido").text($('#'+id).attr('data'));                    $('#suggestions').slideUp(1000);                                    });                          }        });    });                  /* realizar consulta y poblar tabla de asignaturas     * cuando se seleccione una sección.     ****/    $('#select-secc').bind('change', function(e){        poblarAsignaturas();        var id_secciones = document.getElementById('select-secc').value;        var nombre_d_seccion = "";        $(this).find(":selected").each(function () {           nombre_d_seccion += $(this).text() + " ";        });        $("#titulo-contenido").text(nombre_d_seccion);                $.ajax({            type: "POST",            dataType: "json",            data: '',            url: "dbInterfaces/CertificacionesActions.php?action=encabezadoCert&id_secciones=" + id_secciones,                        success: function(data, textStatus, jqXHR){                var content_1 = '<th>Id</th><th class="th-ancho">Alumno</th><th>Unit</th>';                var content = '';                $('.contenido-table-head').css({'font-family':'Verdana','font-size':'14px','font-weight':'bold',                    'background':'url(img/header-bg.gif) left','color':'#CFDCE7'});                for (var i = 0; i < data.length; i++){                content += '<th>' +  data[i].id_ca_cursos + '</th>';                }                $(".contenido-table-head").fadeIn('fast').append(content_1);                $(".contenido-table-head").fadeIn('fast').append(content);            },                    });    });        /* función para poblar la tabla de asignaturas*/    function poblarAsignaturas(e){        var id_secciones = document.getElementById('select-secc').value;        $.ajax({            type: "POST",            dataType: "json",            data: '',            url: "dbInterfaces/CertificacionesActions.php?action=tablaAsignaturas&id_secciones=" + id_secciones,                        success: function(data, textStatus, jqXHR){                var content = '';                $('.table-head-asigna').css({'font-family':'Verdana','font-size':'12px','font-weight':'bold','background':'url(img/header-bg.gif) left','color':'#CFDCE7'});                for (var i = 0; i < data.length; i++){                content += '<tr id="tabla-cursos"><td>' +  data[i].id_ca_cursos + '</td>';                content += '<td>' +  data[i].nombre_d_curso + '</td></tr>';                }                $(".tb-asigna").fadeIn('slow').append(content);                    $('#tabla-cursos*').css({'border':'solid'});            },                    });        }            /*Realiza la consulta de calificaciones por secciónn o por alumno */    $('#boton').bind('click submit', function(){        var id_secciones = document.getElementById('select-secc').value;        var pensum = '';        var cursos = $.ajax({            dataType: "json",            data: '',            url: "dbInterfaces/CertificacionesActions.php?action=contar&id_secciones=" + id_secciones,            async: false,            success: function(data, textStatus, jqXHR){                console.log("Cantidad de cursos obtenidos con éxito!")                pensum = data[0].pensum;            },            error: function(error){                $("#error").html("Errores al contar el pensum de la sección");            },        });        $.ajax({            type: "POST",            dataType: "json",            data: '',            url: "dbInterfaces/CertificacionesActions.php?action=certificaciones&id_secciones=" + id_secciones,            success: function(data, textStatus, jqXHR){                console.log("Los cursos de esta sección son: ", pensum);                var notas = pensum;                var content = '';                var unidad = '';                var bimestre = 0;                for (var i = 0; i < data.length; i++){                    unidad = data[i].id_ca_unidades;                                        if (notas == pensum || unidad != bimestre){                        notas = 0;                        content += '<tr><td>' +  data[i].id_ca_alumnos + '</td>';                        content += '<td id="alumnos">' +  data[i].nombres_alumnos + '</td>';                        content += '<td>' +  data[i].id_ca_unidades + '</td>';                    }                    content += '<td>' +  data[i].calificacion + '</td>';                    notas ++;                    bimestre = unidad;                }                $(".tb-contenido").fadeIn('fast').append(content);                                $('.tb-contenido').css({'font-family':'Verdana', 'font-size': 12, 'color':'#4B5E66','text-align':'center'});                $('.tb-contenido #alumnos').css({'text-align':'left', 'width':'25%'});            },                    });            });        </script></body></html>            