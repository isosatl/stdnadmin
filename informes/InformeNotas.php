<?php    //Script para determinar si se ha iniciado sessión y si es administrador.    if (session_id() == ''){        session_start();                    if (isset($_SESSION['privilegios'])){            if ($_SESSION['privilegios'] == 'admin'){                //mostrar contenido que corresponda a administrador                //print_r($_SESSION['privilegios']);                            }        }    }        if (!isset($_SESSION['usuario']) || (!isset($_SESSION['clave']))) {        $_SESSION['violation'] = 1;        header('Location: ./login.php');        exit();    } if (isset($_SESSION['timeout'])) {        $sessionTTL = time() - $_SESSION['timeout'];        if ($sessionTTL > $_SESSION['tiempoLimite']) {            $_SESSION['logedout'] = 1;            header('Location: ./login.php');            exit();        }    }    $_SESSION['timeout'] = time();    print_r($_SESSION);    include ROOT_DIR . '/includes/header.php';    include ROOT_DIR . '/includes/navinformes.php';    ?>    <body id="notas">    <!--div contenedor general-->    <div id="notas-contenedor">        <div class="encabezado">              <p class="p1">Consulta de notas por sección, ó por alumno.</p> </div>        <div><p class="p2">Seleccione una unidad y una asignatura.</p> </div>        <div class="list-boxes">            <div class="consulta-uno">                <form class="frm-dropdown-uno">                    <table>                        <tr>                            <th id="th-selecc-secc" class="th-drops">                                <select class="tooltip" title="Seleccione una sección y después una unidad" id="select-secc" onfocus="select_secc_focus=1">                                    <option id="drops-opt-secc" value="" selected="selected">Todos los alumnos</option>                                </select>                            </th>                        </tr>                        <tr>                            <th id="th-alumnos" class="th-drops">                                <input class="tooltip" title="Busque un alumno y después seleccione una unidad."                                        type="text" id="service" name="service" onclick="limpiarElementos(this.form)"                                         onFocus="limpiarElementos(this.form)"                                        value="Nombre de alumno...?" ></input>                            </th>                        </tr>                    </table>                </form>            </div>            <div class="consulta-dos">                <form class="frm-dropdown-dos">                    <table>                        <tr>                            <th id="th-select-unidades" class="th-drops">                                <select id="select-unidades" class="tooltip" title="Seleccione una unidad y después una asignatura" >                                    <option id="drops-opt-unidades" value="Default" selected="selected">Selecciones una unidad</option>                                </select>                            </th>                        </tr>                        <tr>                            <th id="th-select-asig-notas" class="th-drops">                                <select  id="select-asigna" class="tooltip" title="Al seleccionar una asignatura se mostrarán los alumnos de la sección, o alumno que ha seleccionado">                                    <option id="drops-opt-asigna" value="Default" selected="selected">Selecciones una asignatura</option>                                </select>                                                                                        </th>                        </tr>                    </table>                                            <div id="suggestions" style="display: block "></div>                </form>            </div>        </div>        <!-- div para mostrar progreso de la carga o errores -->        <div style= "border:1px;" id="info"></div>        <div style = "border: 1px;" id="error"></div>        <div id="titulo-contenido"></div>        <div class="contenido">            <table class="contenido-table">                <thead class="table-head">                    <tr><th></input></th></tr>                </thead>                <tbody class="tb-contenido">                    <tr><th></th></tr>                </tbody>            </table>        </div>    <!--div contenedor-->                         </div>        <!-- Pie de esta página -->    <div id="footer_container"></div>        <script type="text/javascript">        $(document).ready(function(e){        /* poblar secciones */        fillSecciones();                           /* poblar unidades*/        poblarUnidades();                      /* ocultar el div de auto complete*/        $('#suggestions').hide();    });        var encabezado = '';    encabezado = '<tr class="encabezado" id="id_encabezado"><td>Alumno</td><td>Id alumno</td><td>Calificación</td><td>Curso</td><td>Sección</td><td>Unidad</td></tr>';        $('#service').bind('click focus', function(){        var aszTemp = (this.tagName).toLowerCase()            var aszTemp1 = $('.frm-dropdown-dos')[0].tagName;        opacarOpcion(aszTemp);        limpiarElementos(aszTemp1);        $('#select-asigna').empty();        $('#select-asigna').prepend("<option value='Default' selected='selected'>Seleccione una asignatura</option>");    });        function esEnter (event){        if (event.keycode == 13){        event.preventDefault();        notasPorAlumno(service.value);        console.log("Se ha presionado la tecla enter");        }        console.log("Se presionó cualquier tecla!" + service.value);    }        /*** opacar y limpiar elementos y habilitar select de secciones***/    $('#select-secc').bind('change', function(){        $("input[type='text']").val('');        opacarOpcion(select_secc_focus);                limpiarElementos($('.frm-dropdown-dos'));        $('#select-asigna').empty();        $('#select-asigna').prepend("<option value='Default' selected='selected'>Seleccione una asignatura</option>");    });          $('select.tooltip').tooltip({        rounded: true    });        $('input.tooltip').tooltip({        rounded: true    });        /* al precionar una tecla sobre el input de alumno muestra los resultados de autocomplete*/    $('#service').one('keypress', function(){        $('#suggestions').animate({height:100, width:150, opacity: .75}, 1000, 'linear', function(){});                });        //función que muestra las notas de un alumno.    function notasPorAlumno(alumno){    $('.tb-contenido').empty().fadeOut(1000);        $.ajax({            type: 'POST',            dataType: 'json',            data: '',            url: "dbInterfaces/InformeNotasActions.php?action=notasdeAlumno&alumno=" + alumno,            success: function(data, textStatus, jqXHR){                var options = '';                $('.table-head').append(encabezado);                //$('#id_encabezado* td').css({'color': '#2E5257', 'font-size': 18,'background-color':'#99DED1'});                $('.encabezado* td').css({'font-family':'Verdana','font-size':'12px','font-weight':'bold','background':'url(img/header-bg.gif) left','color':'#CFDCE7'});                                for(var i = 0; i < data.length; i++){                    var content = ' ';                    content += '<tr><td>' +  data[i].Alumno + '</td>';                                        content += '<td>' +  data[i].id_ca_alumnos  + '</td>';                    content += '<td>' +  data[i].calificacion + '</td>';                    content += '<td>' +  data[i].id_ca_cursos + '</td>';                    content += '<td>' +  data[i].id_ca_secciones + '</td>';                    content += '<td>' +  data[i].id_ca_unidades + '</td></tr>';                    $('.tb-contenido').fadeIn(1000).append(content);                    $('.contenido* td').css({'font-family':'Verdana', 'font-size': 13, 'text-align':'center','font-color':'black'});                    $('.contenido #izquierda').css({'text-align':'left'});                }            },                      });             }        /* acción de auto completado*/    //Al escribr dentro del input con id="service"                    $('#service').bind('keypress', function(){        var aszTemp = (this.tagName).toLowerCase()                /*** opacar select secciones y habilitar input de alumno***/        opacarOpcion(aszTemp);                //Obtenemos el value del input        var service = $(this).val();        var dataString = 'service='+service;                //Le pasamos el valor del input al ajax        $.ajax({            type: "POST",            url: "dbInterfaces/InfAlumnosActions.php?action=autoCompletado",            data: dataString,            cache: false,            success: function(data) {                                    //Escribimos las sugerencias que nos manda la consulta                $('#suggestions').slideDown(1000).html(data);                //Al hacer click en algua de las sugerencias                $('.suggest-element').live('click', function(){                    //Obtenemos la id unica de la sugerencia pulsada                    var id = $(this).attr('id');                    //Editamos el valor del input con data de la sugerencia pulsada                    $('#service').val($('#'+id).attr('data'));                    $('#suggestions').slideUp(1000);                                    });                          }        });    });                  /* mostrar notas de alumnos cuando se selecciones una asignatura*/    $('#select-asigna').bind('change', function(e){        var nombre_d_curso = "";        $(this).find(":selected").each(function () {           nombre_d_curso += $(this).text() + " ";        });                $("#titulo-contenido").text(nombre_d_curso);        console.log("Curso: " + nombre_d_curso);        var id_secciones = document.getElementById('select-secc').value;        var id_unidades = document.getElementById('select-unidades').value;        var id_cursos = document.getElementById('select-asigna').value;        var alumno = document.getElementById('service').value;        $('.tb-contenido').fadeOut(1000).empty();        //$('.table-head').fadeOut(1000).empty();        $.ajax({            type: 'POST',            dataType: 'json',            data: '',            url: "dbInterfaces/InformeNotasActions.php?action=mostrarNotas&id_secciones=" + id_secciones + "&id_unidades=" + id_unidades + "&id_cursos=" + id_cursos + "&alumno=" + alumno,            success: function(data, textStatus, jqXHR){                var options = '';                $('.tb-contenido').append(encabezado);                $('#id_encabezado* td').css({'color': '#2E5257', 'font-size': 18,'background-color':'#99DED1'});                $('.encabezado* td').css({'font-family':'Verdana','font-size':'12px','font-weight':'bold','background':'url(img/header-bg.gif) left','color':'#CFDCE7'});                for(var i = 0; i < data.length; i++){                    var content = ' ';                    content += '<tr><td>' +  data[i].Alumno + '</td>';                                        content += '<td>' +  data[i].id_ca_alumnos  + '</td>';                    content += '<td>' +  data[i].calificacion + '</td>';                    content += '<td>' +  data[i].id_ca_cursos + '</td>';                    content += '<td>' +  data[i].id_ca_secciones + '</td>';                    content += '<td>' +  data[i].id_ca_unidades + '</td></tr>';                    $('.tb-contenido').fadeIn(1000).append(content);                    $('.contenido* td').css({'font-family':'Verdana', 'font-size': 13, 'text-align':'center','font-color':'black'});                    $('.contenido #izquierda').css({'text-align':'left'});                }            },                      });                     });        /* poblar asignaturas después de seleccionar la sección y la unidad*/        $('#select-unidades').bind('change', function(){        $('#select-asigna').empty();        $('#select-asigna').prepend("<option value='Default' selected='selected'>Seleccione una asignatura</option>");        poblarAsignaturas();    });              /* poblar asignaturas*/    function poblarAsignaturas(e){        var id_secciones = document.getElementById('select-secc').value;        var id_unidades = document.getElementById('select-unidades').value;        var alumno = document.getElementById('service').value;        $.ajax({            type: "POST",            dataType: "json",            data: '',            url: "dbInterfaces/InformeNotasActions.php?action=poblarAsignaBox&id_secciones=" + id_secciones + "&id_unidades=" + id_unidades + "&alumno=" + alumno,            beforeSend: function(xhr){                xhr.setRequestHeader("Accept", "text/javascript");                $('#info').html('<img src="img/ajax-loader.gif" />');            },            complete: function () {                $('#info').empty();                $('#error').empty();                //$("#select-secc").focus();            },            success: function(data, textStatus, jqXHR){                var options = '';                for (var i = 0; i < data.length; i++){                    options += '<option value="' + data[i].id_cursos + '">' + data[i].nombre_d_curso + '</option>';                }                $("#select-asigna").fadeIn('slow').append(options);            },            error: function (response, request, error) {                $("#error").append("<option value=\"0\">No se encontró ningún dato</option>");                                              },        });            }            /* muestra mensajes sobre imanenes*/    //$('.select-secc-notas').bind('mouseover', function(){    //    $('#drops').dropCaptions();    //});       </script>    </body>    </html>